SubDir TOP ;

UseAutoconf ;

Package license.txt readme.txt ;

#### Library ####
SubDir TOP shared_lib ;

LIB_DIRS =
	platform
	platform/sdl
	util
	math
	graphics
	graphics/gl
	sound
	sound/openal
	xml
	lua
	tinyxml
	physfs
;

for i in $(LIB_DIRS) {
	LIB_SOURCES += [ Wildcard sources/$(i) : *.c *.cpp *.h *.hpp ] ;
}

LIB_INCLUDE_DIRS = include include/$(LIB_DIRS) ;

if $(USE_PCH) = "yes" {
	LIB_PCH = include/pch.h ;
	CPPFLAGS += -DUSE_PCH=1 [ CreateIncludeFlags $(LOCATE_TARGET)/include ] ;
}

Library glestlib : $(LIB_SOURCES) : : $(LIB_PCH) ;
ExternalLibs glestlib : SDL GL GLU VORBISFILE OPENAL LUA Z PHYSFS ;
IncludeDir glestlib : $(LIB_INCLUDE_DIRS) ;

#### Game ####
SubDir TOP game ;

GLEST_DIRS =
	.
	ai
	facilities
	game
	global
	graphics
	gui
	main
	menu
	network
	path_finder
	sound
	type_instances
	types
	world
;

for i in $(GLEST_DIRS) {
  GLEST_SOURCES += [ Wildcard $(i) : *.cpp *.h ] ;
}

if $(USE_PCH) = "yes" {
	GLEST_PCH = pch.h ;
#	CPPFLAGS += -DUSE_PCH=1 [ CreateIncludeFlags $(LOCATE_TARGET)/include ] ;
}

Application glestadv : $(GLEST_SOURCES) : : $(GLEST_PCH) ;
LinkWith glestadv : glestlib ;
ExternalLibs glestadv : SDL GL GLU VORBISFILE OPENAL LUA Z PHYSFS ;
IncludeDir glestadv : ../shared_lib/$(LIB_INCLUDE_DIRS) $(GLEST_DIRS) ;

if $(WX_AVAILABLE) = "yes" {
#### Editor ####
  SubDir TOP map_editor ;

  GLEST_MAP_DIRS = . ;
  for i in $(GLEST_DIRS) {
    GLEST_MAP_SOURCES += [ Wildcard $(i) : *.cpp *.h ] ;
  }

  Application glest_editor : $(GLEST_MAP_SOURCES) ;
  LinkWith glest_editor : glestlib ;
  ExternalLibs glest_editor : SDL GL GLU WX PHYSFS ;
  IncludeDir glest_editor : ../shared_lib/$(LIB_INCLUDE_DIRS) $(GLEST_MAP_DIRS) ;

### Viewer ###
  SubDir TOP g3d_viewer ;

  GLEST_VIEWER_DIRS = . ;
  for i in $(GLEST_DIRS) {
    GLEST_VIEWER_SOURCES += [ Wildcard $(i) : *.cpp *.h ] ;
  }

  Application glest_g3dviewer : $(GLEST_VIEWER_SOURCES) ;
  LinkWith glest_g3dviewer : glestlib ;
  ExternalLibs glest_g3dviewer : SDL GL GLU WX PHYSFS ;
  IncludeDir glest_g3dviewer : ../shared_lib/$(LIB_INCLUDE_DIRS) $(GLEST_VIEWER_DIRS) ;

### Configurator ###
  SubDir TOP configurator ;

  GLEST_CONFIG_DIRS = . ;
  for i in $(GLEST_DIRS) {
    GLEST_CONFIG_SOURCES += [ Wildcard $(i) : *.cpp *.h ] ;
  }

  Application glest_configurator : $(GLEST_CONFIG_SOURCES) ;
  LinkWith glest_configurator : glestlib ;
  ExternalLibs glest_configurator : SDL GL GLU WX PHYSFS ;
  IncludeDir glest_configurator : ../shared_lib/$(LIB_INCLUDE_DIRS) $(GLEST_CONFIG_DIRS) ;
}

### testsuite ###
if $(CPPUNIT) = "yes" {
  SubDir TOP test ;
  GLEST_TEST_DIRS = . search datastructs facilities ;
#   for i in $(GLEST_TEST_DIRS) {
#     GLEST_TEST_SOURCES += [ Wildcard $(i) : *.cpp *.h ] ;
#   }
  GLEST_TEST_SOURCES =
	search/influence_map_test.cpp
	search/annotated_map_test.cpp
	main.cpp
	datastructs/circular_buffer_test.cpp
	facilities/reverse_rect_iter_test.cpp
	pch.cpp
	pch.h
	search/influence_map_test.h
	search/annotated_map_test.h
	datastructs/circular_buffer_test.h
	facilities/reverse_rect_iter_test.h
  ;
  Application testsuite : $(GLEST_TEST_SOURCES) ;
  LinkWith testsuite : glestlib ;
  ExternalLibs testsuite : SDL CPPUNIT ;
  IncludeDir testsuite : ../shared_lib/$(LIB_INCLUDE_DIRS) $(GLEST_TEST_DIRS) ../game/$(GLEST_DIRS) ;
}

### glexemel ###
if $(XML) = "yes" {
  SubDir TOP glexemel ;

  Application g2xml : g2xml.c g3dv4.h ;

  Application xml2g : xml2g.c g3dv4.h ;
  ExternalLibs xml2g : XML ;
}
